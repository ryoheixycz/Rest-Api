<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yuri API Dashboard</title>
    <meta name="description" content="Discover Ajiro API's powerful and flexible solutions to enhance your applications.">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        @layer base {
            :root {
                --bg-color: #121212;
                --text-color: #e0e0e0;
                --accent-color: #3498db;
                --border-color: #2c2c2c;
                --hover-color: #1e1e1e;
                --card-bg-color: #1a1a1a;
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex flex-col">

    <!-- Loading Spinner -->
    <div class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center" id="loading-spinner">
        <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
    </div>

    <!-- Header -->
    <header class="bg-gray-800 fixed w-full top-0 z-50 shadow-lg">
        <div class="flex justify-between items-center max-w-7xl mx-auto px-4 py-3">
            <!-- Menu Button -->
            <button id="menu-toggle" class="text-white text-2xl p-2 focus:outline-none md:hidden">â˜°</button>
            
            <!-- Logo and Title -->
            <div class="flex items-center space-x-3">
                <img src="https://files.catbox.moe/ufipxm.jpg" alt="Logo" class="w-10 h-10 rounded-full">
                <h1 class="text-2xl font-bold">Yuri API Dashboard</h1>
            </div>
            
            <!-- Profile and Dropdown -->
            <div class="relative">
                <button id="profile-dropdown-toggle" class="flex items-center focus:outline-none">
                    <img src="https://files.catbox.moe/ufipxm.jpg" alt="Profile" class="w-8 h-8 rounded-full object-cover cursor-pointer">
                    <span class="ml-2 text-white">User</span>
                </button>
                <!-- Dropdown Menu -->
                <div id="profile-dropdown" class="hidden absolute right-0 mt-2 py-2 w-48 bg-gray-800 shadow-lg rounded-lg z-50">
                    <a href="#" class="block px-4 py-2 text-gray-200 hover:bg-gray-700">Profile</a>
                    <a href="#" class="block px-4 py-2 text-gray-200 hover:bg-gray-700">Settings</a>
                    <a href="#" class="block px-4 py-2 text-gray-200 hover:bg-gray-700">Logout</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <nav id="sidebar" class="fixed top-12 left-0 bg-gray-800 text-gray-200 w-64 h-full z-40 shadow-lg transition-transform transform -translate-x-full md:translate-x-0 md:top-0">
        <ul class="space-y-2 py-4 px-4" id="category-list"></ul>
    </nav>

    <!-- Main Content -->
    <main id="main-content" class="flex-grow pt-16 pb-4 px-6 md:ml-64 overflow-auto">
    </main>

    <!-- JavaScript -->
    <script>
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const categoryList = document.getElementById('category-list');
        const loadingSpinner = document.getElementById('loading-spinner');
        const profileDropdownToggle = document.getElementById('profile-dropdown-toggle');
        const profileDropdown = document.getElementById('profile-dropdown');
        
        let currentCategory = 'home';
        let currentScroll = 0;

        // Toggle sidebar on mobile
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
        });

        // Toggle profile dropdown
        profileDropdownToggle.addEventListener('click', () => {
            profileDropdown.classList.toggle('hidden');
        });

        const capitalizeFirstLetter = string => string.charAt(0).toUpperCase() + string.slice(1);

        function showLoading() {
            loadingSpinner.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function hideLoading() {
            loadingSpinner.classList.add('hidden');
            document.body.style.overflow = '';
        }

        async function fetchWithTimeout(resource, options = {}) {
            const { timeout = 8000 } = options;
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeout);
            try {
                const response = await fetch(resource, {
                    ...options,
                    signal: controller.signal
                });
                clearTimeout(id);
                return response;
            } catch (error) {
                clearTimeout(id);
                throw error;
            }
        }

        async function initializeDashboard() {
            showLoading();
            try {
                const [apiListResponse, statsResponse] = await Promise.all([
                    fetchWithTimeout('/api-list'),
                    fetchWithTimeout('/api-stats')
                ]);

                if (!apiListResponse.ok || !statsResponse.ok) {
                    throw new Error('Failed to fetch data');
                }

                const apis = await apiListResponse.json();
                const stats = await statsResponse.json();
                const groupedApis = apis?.reduce((acc, api) => {
                    const category = api.category || 'Uncategorized';
                    (acc[category] = acc[category] || []).push(api);
                    return acc;
                }, {});
                setupCategoryNavigation(groupedApis || {}, stats || {});
                showHomePage(stats || {}, groupedApis || {});
            } catch (error) {
                console.error('Failed to fetch data:', error);
                showErrorMessage();
            } finally {
                hideLoading();
            }
        }

        function setupCategoryNavigation(groupedApis, stats) {
            const categories = ['Home', ...Object.keys(groupedApis).sort()];
            categoryList.innerHTML = categories.map(category => 
                `<li><button class="category-button w-full text-left py-2 px-4 rounded-lg bg-gray-700 hover:bg-gray-600 focus:bg-gray-600 transition" data-category="${category.toLowerCase()}">${capitalizeFirstLetter(category)}</button></li>`
            ).join('');

            categoryList.addEventListener('click', (e) => {
                if (e.target.classList.contains('category-button')) {
                    const category = e.target.dataset.category;
                    document.querySelectorAll('.category-button').forEach(btn => btn.classList.remove('bg-gray-600'));
                    e.target.classList.add('bg-gray-600');

                    currentScroll = window.scrollY;
                    currentCategory = category;

                    if (category === 'home') {
                        showHomePage(stats, groupedApis);
                    } else {
                        showCategoryApis(category, groupedApis[category]);
                    }

                    if (window.innerWidth <= 768) {
                        sidebar.classList.add('-translate-x-full');
                    }
                }
            });
        }

        function showHomePage(stats, groupedApis) {
            const totalApis = stats.totalApis || 0;
            const totalCategories = Object.keys(groupedApis).length || 0;

            mainContent.innerHTML = `
                <h2 class="text-2xl font-bold mb-4">Welcome to Ajiro API</h2>
                <p class="mb-6">Explore our APIs by clicking on the categories in the sidebar to find the one you need.</p>
                
                <div class="stats-card p-6 bg-gray-800 rounded-lg shadow-lg mb-8">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="stat-item">
                            <div class="stat-label text-gray-400">Browser CodeName</div>
                            <div class="stat-value text-lg text-blue-500">${stats.browserCodeName || 'N/A'}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label text-gray-400">Browser Name</div>
                            <div class="stat-value text-lg text-blue-500">${stats.browserName || 'N/A'}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label text-gray-400">Total APIs</div>
                            <div class="stat-value text-lg text-blue-500">${totalApis}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label text-gray-400">Total Categories</div>
                            <div class="stat-value text-lg text-blue-500">${totalCategories}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label text-gray-400">Platform</div>
                            <div class="stat-value text-lg text-blue-500">${stats.platform || 'N/A'}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label text-gray-400">Screen Resolution</div>
                            <div class="stat-value text-lg text-blue-500">${stats.resolution || 'N/A'}</div>
                        </div>
                    </div>
                </div>
            `;
            window.scrollTo(0, 0);
        }

        function showCategoryApis(category, apis) {
            mainContent.innerHTML = `
                <h2 class="text-2xl font-bold mb-4">${capitalizeFirstLetter(category)} APIs</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${apis.map(api => `
                        <div class="api-card bg-gray-800 rounded-lg p-4 shadow-lg hover:bg-gray-700 transition">
                            <h3 class="text-lg font-semibold mb-2">${api.name}</h3>
                            <p class="text-gray-400 mb-4">${api.description}</p>
                            <a href="${api.link}" target="_blank" class="inline-block bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition">Visit API</a>
                        </div>
                    `).join('')}
                </div>
            `;
            window.scrollTo(0, 0);
        }

        function showErrorMessage() {
            mainContent.innerHTML = `
                <h2 class="text-2xl font-bold mb-4">Error Loading Data</h2>
                <p>Sorry, there was an issue fetching the data. Please try again later.</p>
            `;
        }

        initializeDashboard();
    </script>
</body>
    </html>
    
